# 📊 股票监控系统 - 详细模板功能更新完成

## 🎯 更新内容概述

基于您选择的**详细版微信模板**，系统已成功升级，现在支持更丰富的消息推送格式。

## ✅ 已完成的功能

### 1. 🔧 核心功能增强

- ✅ **详细模板支持**：新增 `send_wechat_message_with_decisions()` 函数
- ✅ **12 字段完整模板**：支持完整的详细信息展示
- ✅ **多模板兼容**：自动降级兼容（详细 → 简化详细 → 标准 → 极简）
- ✅ **智能决策传递**：决策信息完整传递给消息推送模块

### 2. 📱 微信模板字段详情

详细版模板包含以下 12 个字段：

1. **title** - 消息标题（🚨 股票监控提醒）
2. **report_time** - 报告时间（2025-01-25 10:00:00）
3. **stock_count** - 监控股票数量（1 只）
4. **action_count** - 需要操作数量（1 项）
5. **stock_name** - 股票名称（南方中证 500ETF）
6. **current_price** - 当前价格（¥5.987）
7. **base_price** - 基准价格（¥6.140）
8. **price_change** - 涨跌幅（-2.49%）
9. **decision** - 操作决策（🟢 建议买入）
10. **suggestion** - 具体建议（价格下跌 2.49%，触发 5%以内买入策略）
11. **note** - 股票备注（中盘股核心配置，跟踪中证 500 指数）
12. **warning** - 风险提示（投资有风险，决策需谨慎）

### 3. 🕙 系统运行时间

- **执行时间**：每天北京时间上午 10:00（UTC 02:00）
- **监控频率**：每日自动检查
- **目标股票**：南方中证 500ETF (sh510500)

### 4. 📈 交易策略配置

**买入规则**：

- 下跌 5% 时投入 20% 资金
- 下跌 10% 时投入 30% 资金

**卖出规则**：

- 上涨 15% 时卖出 20% 仓位
- 上涨 30% 时卖出 30% 仓位

## 🔧 技术改进详情

### 代码结构优化

```python
# 新增功能函数
def send_wechat_message_with_decisions(access_token, open_id, template_id, title, content, decisions):
    """向单个用户发送微信模板消息 - 支持详细版模板（带决策信息）"""

    # 支持4种模板格式的自动降级
    # 1. 详细版模板（12字段）
    # 2. 简化详细模板（6字段）
    # 3. 标准模板（4字段）
    # 4. 极简模板（1字段）
```

### 模板兼容性机制

1. **首选详细模板**：尝试发送包含所有 12 个字段的完整信息
2. **自动降级**：如果字段不匹配，自动尝试简化版本
3. **保证送达**：确保消息在任何模板配置下都能成功发送
4. **错误处理**：详细的错误信息和状态反馈

## 📋 使用指南

### 在微信公众号后台配置模板

如果您在微信公众号后台已经申请了详细版模板，请确保包含以下字段：

```
标题：{{title.DATA}}
报告时间：{{report_time.DATA}}
监控股票：{{stock_count.DATA}}
需要操作：{{action_count.DATA}}
股票名称：{{stock_name.DATA}}
当前价格：{{current_price.DATA}}
基准价格：{{base_price.DATA}}
涨跌幅：{{price_change.DATA}}
操作决策：{{decision.DATA}}
投资建议：{{suggestion.DATA}}
备注：{{note.DATA}}
风险提示：{{warning.DATA}}
```

### GitHub Secrets 配置

确保在 GitHub 仓库的 Settings > Secrets 中配置：

- `WECHAT_APP_ID` - 微信公众号 AppID
- `WECHAT_APP_SECRET` - 微信公众号 AppSecret
- `WECHAT_TEMPLATE_ID` - 微信模板消息 ID
- `WECHAT_OPEN_IDS` - 接收用户的 OpenID（多个用逗号分隔）

## 🚀 系统状态

✅ **配置文件**：config.json 格式正确，包含完整的买卖规则  
✅ **GitHub 工作流**：daily_check.yml 设置为北京时间 10:00 执行  
✅ **微信模板**：支持详细版模板，包含 12 个字段  
✅ **自动化运行**：每日自动监控并推送提醒消息

## 🔍 测试验证

系统已通过以下测试：

1. ✅ **语法检查**：Python 代码语法正确
2. ✅ **模板测试**：详细模板数据结构验证通过
3. ✅ **配置检查**：股票配置和交易规则正确
4. ✅ **工作流验证**：GitHub Actions 配置正确

## 📞 下一步操作

1. **提交代码**：将所有更改推送到 GitHub 仓库
2. **配置模板**：在微信公众号后台配置详细版模板
3. **设置 Secrets**：在 GitHub 仓库中配置微信相关密钥
4. **等待执行**：系统将在明天上午 10:00 开始自动运行

---

💡 **提示**：如果仍然无法收到微信消息，请检查：

- 微信公众号模板 ID 是否正确
- OpenID 是否有效
- 模板字段是否与代码中的字段名称完全匹配
- 微信公众号是否有发送模板消息的权限

🎉 **恭喜！您的股票监控系统现在支持详细版微信模板推送功能！**
